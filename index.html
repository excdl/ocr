<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>離線護照 / 台胞證 OCR</title>
<script src="tesseract.min.js"></script>
<style>
body{font-family:Arial; margin:20px;}
button{padding:10px 15px; margin:5px;}
canvas,video{width:100%; display:none; margin-top:10px;}
pre{background:#222; color:#0f0; padding:10px; height:150px; overflow:auto;}
</style>
</head>
<body>
<h1>離線護照 / 台胞證 OCR</h1>
<button id="uploadBtn">上傳圖片</button>
<input type="file" id="fileInput" accept="image/*" style="display:none">
<button id="cameraBtn">開啟相機</button>
<button id="captureBtn" disabled>拍照 OCR</button>
<video id="camera" autoplay playsinline></video>
<canvas id="previewCanvas"></canvas>
<pre id="ocrResult">OCR 結果顯示在這裡</pre>

<script>
const fileInput=document.getElementById('fileInput');
const uploadBtn=document.getElementById('uploadBtn');
const cameraBtn=document.getElementById('cameraBtn');
const captureBtn=document.getElementById('captureBtn');
const previewCanvas=document.getElementById('previewCanvas');
const ocrResult=document.getElementById('ocrResult');
const camera=document.getElementById('camera');

let worker;
(async()=>{
    try{
        worker = Tesseract.createWorker({
            workerPath: 'tesseract.worker.min.js',
            logger: m => { if(m.status==='recognizing text') ocrResult.innerText=m.text||''; }
        });
        await worker.load();
        await worker.loadLanguage('eng+chi_tra+chi_sim');
        await worker.initialize('eng+chi_tra+chi_sim');
        captureBtn.disabled=false;
        console.log("Tesseract 初始化完成 ✅");
    }catch(e){
        console.error("Tesseract 初始化失敗 ❌", e);
        ocrResult.innerText="Tesseract 初始化失敗 ❌";
    }
})();

// 上傳圖片
uploadBtn.onclick=()=>fileInput.click();
fileInput.onchange=e=>{
    if(e.target.files.length===0) return;
    const img=new Image();
    img.onload=()=>{
        previewCanvas.width=img.width;
        previewCanvas.height=img.height;
        const ctx=previewCanvas.getContext('2d');
        ctx.drawImage(img,0,0);
        previewCanvas.style.display='block';
        processCanvas(previewCanvas);
    };
    img.src=URL.createObjectURL(e.target.files[0]);
};

// 開啟相機
cameraBtn.onclick=async()=>{
    try{
        const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
        camera.srcObject=stream;
        camera.style.display='block';
        previewCanvas.style.display='block';
    }catch(e){ alert("無法開啟相機"); }
};

// 拍照 OCR
captureBtn.onclick=()=>{ processCanvas(previewCanvas, camera); };

async function processCanvas(canvas, video){
    if(video){
        const ctx=canvas.getContext('2d');
        canvas.width=video.videoWidth;
        canvas.height=video.videoHeight;
        ctx.drawImage(video,0,0);
    }
    if(!worker) return;
    try{
        const { data:{ text } } = await worker.recognize(canvas);
        ocrResult.innerText=text;
    }catch(e){
        console.error("OCR 失敗", e);
        ocrResult.innerText="OCR 失敗 ❌";
    }
}
</script>
</body>
</html>



















































